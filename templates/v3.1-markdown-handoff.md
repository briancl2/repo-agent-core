# v3.1 Markdown Handoff Template

> From portfolio_advisor addendum Â§4 (proven in production, 55+ runs).
> Used by all subagent delegations across auditor, advisor, and optimizer.

---

## Handoff
- **From:** {orchestrator-agent-id}
- **To:** {subagent-id}
- **Intent:** audit | optimize | synthesize
- **Summary:** {one-line description}

## Context
- **Objective:** {detailed objective}
- **Inputs to read:** {file list}
- **Context checkpoint:** PASS/FAIL + list of files read
- **Context already gathered:** {orchestrator fills with prior-phase facts}
- **Constraints:**
  ðŸš¨ No file modifications; cite exact file paths
  ðŸš¨ Separate facts vs inference
  ðŸš¨ Use severity labels (Critical/High/Medium/Low/Info)
- **Required outputs:** {Findings table with specific column schema}
- **Stop rules:**
  - Maximum {N} files examined
  - Maximum {N} findings
  - Return partial results if incomplete

---

## Invariants (non-negotiable)

1. **Context checkpoint is MANDATORY** â€” PASS/FAIL + files read
2. **Evidence quotes â‰¥20 characters** â€” literal substrings, no ellipses
3. **Stop rules in every handoff** â€” max files, max findings, timeout
4. **Single-level nesting** â€” subagents never spawn subagents
5. **Partial results accepted** â€” always include "Return partial results if incomplete"

## Auto-Repair Loop (after each subagent)

1. Verify v3.1 handoff markers present in response
2. If noncompliant â†’ re-prompt ONCE with format request
3. If still noncompliant â†’ proceed with WARN, store raw payload
4. Write accepted payload to `payloads/<subagent-id>.md`
